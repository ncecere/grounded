FROM oven/bun:1
WORKDIR /app

ARG VERSION=dev
ENV APP_VERSION=$VERSION

# Copy everything at once for workspace resolution
COPY package.json bun.lockb* ./
COPY packages ./packages
COPY apps/ingestion-worker ./apps/ingestion-worker

# Install dependencies after source is available
RUN bun install || true

ENV NODE_ENV=production
CMD ["bun", "run", "apps/ingestion-worker/src/index.ts"]
