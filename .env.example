# =============================================================================
# Grounded Environment Configuration
# =============================================================================

# =============================================================================
# Core Infrastructure
# =============================================================================

# Application Database
POSTGRES_USER=grounded
POSTGRES_PASSWORD=your_secure_password
POSTGRES_DB=grounded
DATABASE_URL=postgres://grounded:your_secure_password@localhost:5432/grounded

# Vector Database (separate PostgreSQL cluster with pgvector)
# Dimensions are not configured here - the system dynamically uses dimensions
# based on each KB's configured embedding model
# Option 1: Use connection URL
VECTOR_DB_URL=postgres://grounded_vectors:your_vectors_secure_password@localhost:5433/vectors
# Option 2: Use individual components (if URL not set)
# VECTOR_DB_HOST=localhost
# VECTOR_DB_PORT=5433
# VECTOR_DB_USER=grounded_vectors
# VECTOR_DB_PASSWORD=your_vectors_secure_password
# VECTOR_DB_NAME=vectors
# VECTOR_DB_TYPE=pgvector
# VECTOR_DB_SSL=false

# Redis
REDIS_URL=redis://localhost:6379

# =============================================================================
# API Server
# =============================================================================

# Server port (default: 3000)
# PORT=3000

# Session secret for JWT signing (must be at least 32 characters)
SESSION_SECRET=your_session_secret_at_least_32_chars_long

# CORS Origins (comma-separated list)
CORS_ORIGINS=http://localhost:8088

# Application URL (used in alert emails)
# APP_URL=http://localhost:8088

# Skip database migrations on startup (default: false)
# SKIP_MIGRATIONS=false

# =============================================================================
# Authentication
# =============================================================================

# System Admin (seeded on first startup)
# After first login, manage users via the Admin UI
ADMIN_EMAIL=admin@yourcompany.com
ADMIN_PASSWORD=YourSecurePassword123!

# OIDC Authentication (optional - for SSO)
# OIDC_ISSUER=https://your-idp.com
# OIDC_CLIENT_ID=your_client_id
# OIDC_CLIENT_SECRET=your_client_secret
# OIDC_REDIRECT_URI=http://localhost:3000/api/v1/auth/oidc/callback
# OIDC_AUDIENCE=your_audience                # Optional: expected audience claim

# =============================================================================
# Internal Communication
# =============================================================================

# Internal API Key (for worker-to-API communication)
# Workers use this to fetch configuration from the database.
# Generate a secure random string for production (e.g., openssl rand -hex 32)
# If not set, internal API endpoints are open (suitable for local dev only)
# INTERNAL_API_KEY=your_internal_api_key_at_least_32_chars

# Frontend API URL (for workers to reach the API)
# Leave empty in production - Ingress routes /api to API service
API_URL=http://localhost:3001

# =============================================================================
# External Services
# =============================================================================

# Firecrawl (optional - for URL scraping without local Chromium)
# FIRECRAWL_API_KEY=your_firecrawl_api_key
# FIRECRAWL_API_URL=https://api.firecrawl.dev  # Custom Firecrawl endpoint

# =============================================================================
# Worker Configuration
# =============================================================================
# NOTE: Worker settings can also be configured via Admin UI (Settings > Workers).
# Admin UI settings take precedence over these environment variables.
# Workers fetch settings from the API at startup and refresh every 60 seconds.
#
# These env vars serve as fallbacks when:
# - The API is unavailable during worker startup
# - Settings haven't been configured in the Admin UI yet

# Worker concurrency settings (fallback values)
# WORKER_CONCURRENCY=5             # Scraper/ingestion concurrency (default: 5)
# INDEX_WORKER_CONCURRENCY=5       # Page index worker concurrency (default: 5)
# EMBED_WORKER_CONCURRENCY=4       # Concurrent embedding jobs (default: 4)

# Embedding performance tuning
# EMBEDDING_BATCH_SIZE=100         # Texts per embedding API call (default: 100)
# EMBEDDING_PARALLEL_BATCHES=3     # Concurrent API calls per embed job (default: 3)

# Scraper settings
# PLAYWRIGHT_HEADLESS=true         # Run browser in headless mode (default: true)

# Scraper fairness scheduler (fallback values - prefer Admin UI configuration)
# Distributes scraper worker capacity across concurrent source runs
# FAIRNESS_DISABLED=false                   # Set to true to disable fairness scheduling
# FAIRNESS_TOTAL_SLOTS=5                    # Total slots (defaults to WORKER_CONCURRENCY)
# FAIRNESS_MIN_SLOTS_PER_RUN=1              # Minimum slots per run (prevents starvation)
# FAIRNESS_MAX_SLOTS_PER_RUN=10             # Maximum slots per run (prevents monopolization)
# FAIRNESS_RETRY_DELAY_MS=500               # Delay before retry when slots unavailable
# FAIRNESS_DEBUG=false                      # Enable debug logging for fairness scheduler

# Stage processing (ingestion pipeline)
# STAGE_BATCH_SIZE=100             # Items per stage batch (default: 100)
# JOBS_PER_SECOND_PER_RUN=10       # Rate limit per source run (default: 10)

# Embed completion gating (wait for embeddings before marking run complete)
# EMBED_COMPLETION_GATING_DISABLED=false    # Disable gating (default: false)
# EMBED_COMPLETION_WAIT_MS=30000            # Max wait time (default: 30s)
# EMBED_COMPLETION_CHECK_INTERVAL_MS=1000   # Check interval (default: 1s)

# Settings refresh interval (how often workers check for updated settings)
# SETTINGS_REFRESH_INTERVAL_MS=60000        # Default: 60 seconds

# =============================================================================
# Logging Configuration
# =============================================================================

# Log level: debug, info, warn, error (default: info)
# LOG_LEVEL=info

# Sampling for high-volume logs (0.0-1.0, default: 1.0 = log everything)
# LOG_SAMPLE_RATE=1.0

# Slow request threshold in ms (always logged regardless of sampling)
# LOG_SLOW_THRESHOLD_MS=2000

# Always log errors regardless of sampling (default: true)
# LOG_ALWAYS_ERRORS=true

# Comma-separated operations to always log (e.g., "auth,chat")
# LOG_ALWAYS_OPERATIONS=

# Service version for log metadata
# SERVICE_VERSION=0.1.0

# =============================================================================
# AI Models - Configure via Admin UI (Settings > AI Models)
# =============================================================================
# LLM and Embedding providers are now managed in the database via the Admin UI.
# No environment variables needed - add providers and models through the UI.
#
# Supported providers:
# - OpenAI (gpt-4o, gpt-4o-mini, text-embedding-3-small, etc.)
# - Anthropic (claude-3-opus, claude-3-sonnet, etc.)
# - Google (gemini-pro, etc.)
# - OpenAI-compatible (Groq, Together, Ollama, etc.)
